#include "frame_buffer.h"
#include <stdio.h>

void buffer_init() {
	*ws_base = 0x0000;
	*output_base = 0x00FFFFFF;
	for (int i = 0; i < SCREEN_HEIGHT; i++)
		for (int j =0; j < SCREEN_WIDTH; j++) {
			buffer[j*SCREEN_WIDTH + i] = bg_data[j*BG_WIDTH + i];
		}
	write_to_ocm();
}

void write_to_ocm() {
	*ws_base = 0x0001;
	for (int i = 0; i < SCREEN_WIDTH; i++)
		for (int j = 0; j < SCREEN_HEIGHT; j++){
			unsigned int address = (j*SCREEN_WIDTH + i)&0x00FFFFFF;
			unsigned int data = buffer[j*SCREEN_WIDTH + i];
			//printf("%d: %2x\n", address, data);
			data = (data<<24) + address;
			while ((*input_base)!=0);
			//printf("%2x", *input_base);
			*output_base = data;

			while ((*input_base)!=1) {}

			*output_base = 0x00FFFFFF;
		}
	*ws_base = 0x0000;
}
